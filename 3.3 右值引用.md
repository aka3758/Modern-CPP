# 3.3 右值引用

我感觉，右值引用绝对是现代 C++ 中最重要的特性。解决了很多历史遗留问题。

右值引用消除了诸如 std::vector、std::string 等容器额外的开销，也使得函数对象容器 std::function 成为了可能。

## 左值、右值、纯右值、将亡值

我们先详细区分一些现代 C++ 中的各种值

### 左值

英文是 lvalue，表示的是存储在内存中、有明确存储地址（可寻址）的数据。

### 右值

英文是 rvalue，表示的是那些可以提供数据值的数据（不一定可以寻址，例如存储于寄存器中的数据）。

C++11 中为了引入强大的右值引用，将右值的概念进行了进一步的划分，分为纯右值、将亡值。

#### 纯右值

英文是 prvalue，纯粹的右值。要么是纯粹的字面量，如 10, true等；要么是求职结果相当于字面量或临时对象，如 1 + 2。非引用返回的临时变量、运算表达式产生的临时变量、原始字面量、Lambda 表达式都属于纯右值。

#### 将亡值

英文是 xvalue，C++11 引入右值引用而提出的概念。表示即将被销毁、却能够被移动的值。

### 个人看法和理解

有几个问题说一下：

名称问题：这个名称的翻译真是很有问题，可能比较形象，但是过于表象，不够底层。而且给人一种好像因为位于赋值符号左边才叫左值的感觉。

这就好像取地址和取内容，我更喜欢叫它引用和解引用。

### C++之父对于值的理解

B神原话：

For all the values, there were only two independent properties:

"has identity" – i.e. an address, a pointer, the user can determine whether two copies are identical, etc.

"can be moved from" – i.e. we are allowed to leave to source of a "copy" in some indeterminate, but valid state.
There are four possible composition:

iM: has identity and cannot be moved from (defined as lvalue)
im: has identity and can be moved from (defined as xvalue)
Im: does not have identity and can be moved from (defined as prvalue)
IM: doesn't have identity and cannot be moved (他认为这种情况在 C++ 中是没有用的)

大概意思就是，C++ 中的值有两个属性，一个是身份，一个是可移动。

身份：能够确定某个表达式是否和另一个表达式指涉同一个实体，比如指针，名称之类的东西。

可移动：能够被移动构造函数、移动赋值操作符或者其它实现移动语义的重载函数绑定。

lvalue：所谓的左值，有身份，不能被移动

xvalue：所谓的将亡值，有身份，可移动

pvalue：所谓的纯右值，没有身份，可移动

另一种情况大神认为在 C++ 中没有意义。

关于 C++ 值类型更多的知识：[cppreference.com](https://en.cppreference.com/mwiki/index.php?title=cpp/language/value_category&oldid=85137)